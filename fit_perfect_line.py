# Beispiel: deine Arrays
waypoints_old = [
        [3.408314959676616, 1.4717702850315393],
        [3.278316020965576, 1.471244990825653],
        [3.148323229010334, 1.4698760351357125],
        [2.974927544593811, 1.4680500030517578],
        [2.671554446220398, 1.4732159972190857],
        [2.3681689500808716, 1.4696124792099],
        [2.0653909444808973, 1.4793429970741272],
        [1.7702519893646231, 1.5481655001640322],
        [1.483372986316681, 1.6465474963188171],
        [1.1825209856033325, 1.665496051311493],
        [0.8996591567993164, 1.55953049659729],
        [0.6058058738708496, 1.493058979511261],
        [0.3036217987537384, 1.4668729901313782],
        [0.00022387993521988392, 1.4644305109977722],
        [-0.3031398057937622, 1.4698509573936462],
        [-0.6065511703491211, 1.4700390100479126],
        [-0.9099699556827545, 1.4700774550437927],
        [-1.2133870124816895, 1.4710184931755066],
        [-1.516803503036499, 1.472249984741211],
        [-1.8202179670333862, 1.4738149642944336],
        [-2.1236274242401123, 1.4759759902954102],
        [-2.427031993865967, 1.4785684943199158],
        [-2.7303649187088013, 1.472720980644226],
        [-3.0334941148757935, 1.4606574773788452],
        [-3.336466908454895, 1.4711779952049255],
        [-3.6301519870758057, 1.54459547996521],
        [-3.9102929830551147, 1.65993994474411],
        [-4.20968532562256, 1.703934550285339],
        [-4.496387481689454, 1.6192825436592089],
        [-4.708314418792725, 1.4057174921035767],
        [-4.802008390426635, 1.1188610196113604],
        [-4.860429525375366, 0.8211241662502311],
        [-4.920632362365723, 0.5237410515546799],
        [-4.97938084602356, 0.22606505453586578],
        [-5.031064033508301, -0.07268327847123146],
        [-4.979203701019287, -0.36956214904785156],
        [-4.809752941131592, -0.617946207523346],
        [-4.550312995910643, -0.7715703397989278],
        [-4.257645130157471, -0.8490209430456161],
        [-3.9584025144577026, -0.8976912498474121],
        [-3.6566635370254517, -0.9255106151103973],
        [-3.3626874685287476, -0.9994447827339172],
        [-3.0748790502548218, -1.0955036282539368],
        [-2.786156415939331, -1.1866423189640045],
        [-2.486029028892517, -1.2304852604866028],
        [-2.1842055320739746, -1.2615086436271667],
        [-1.8819324970245361, -1.2877083718776703],
        [-1.5803679823875427, -1.260584980249405],
        [-1.2913404703140259, -1.1709365844726562],
        [-0.9996453821659088, -1.0925500392913818],
        [-0.6984832286834717, -1.116917371749878],
        [-0.420046791434288, -1.2342189252376556],
        [-0.14777036756277084, -1.3665609955787659],
        [0.14819640666246414, -1.4308984875679016],
        [0.4421359449625015, -1.3735359907150269],
        [0.6987309455871582, -1.212949424982071],
        [0.9145341217517853, -1.0006998777389526],
        [1.1385363936424255, -0.7995848059654236],
        [1.4211704730987549, -0.6919995695352554],
        [1.7221534848213196, -0.6560808718204498],
        [2.024604022502899, -0.6640181243419647],
        [2.3245800733566284, -0.7095721513032913],
        [2.6152199506759644, -0.7918080240488052],
        [2.857451558113098, -0.9721536040306091],
        [2.9898489713668823, -1.240626037120819],
        [3.1674790382385254, -1.4824514985084534],
        [3.4428740739822388, -1.601032018661499],
        [3.7423360347747803, -1.6497185230255127],
        [4.044067859649658, -1.681160032749176],
        [4.347193956375122, -1.6917835474014282],
        [4.643414497375488, -1.6374415159225464],
        [4.8928515911102295, -1.4685439467430115],
        [5.023529529571533, -1.1997559666633606],
        [5.024764060974121, -0.8974809050559998],
        [4.991261959075928, -0.5959695875644686],
        [4.958872318267822, -0.29428809881210327],
        [4.9252283573150635, 0.007256770506501198],
        [4.894884347915649, 0.3091498017311096],
        [4.8511130809783936, 0.6092253923416138],
        [4.804372549057007, 0.9090217053890233],
        [4.708405017852783, 1.1938440203666687],
        [4.480142593383789, 1.3866339921951294],
        [4.187997817993164, 1.4637395143508911],
        [3.8851370811462402, 1.47393000125885],
        [3.5817264318466187, 1.472470998764038],
        [3.408314959676616, 1.4717702850315393]]
waypoints = [[3.333586135833019, 1.4158520035907074], [3.209152374373051, 1.436033126865557], [3.0598261873780874, 1.4540559115183302], [2.823529372475652, 1.474291339592665], [2.5203172665589624, 1.4887854299873629], [2.2171029309914476, 1.49582846411182], [1.9177030205133656, 1.499640037670521], [1.6265150052620565, 1.501468830399817], [1.3331456363565715, 1.501834025853193], [1.0416306718065453, 1.5010055332868757], [0.7529423080274055, 1.4992415511604988], [0.4545438879169523, 1.4966040207315143], [0.15158557759701902, 1.4932253268582198], [-0.15169172783114931, 1.489802182884224], [-0.45498757232887294, 1.4869688359787419], [-0.7583510841576978, 1.4847667836108214], [-1.0617257987321875, 1.4832674400487633], [-1.3651034359005334, 1.482589665436627], [-1.668482856458589, 1.4829063463670378], [-1.9718542233364884, 1.4844285499231245], [-2.2752044468340547, 1.487401869166394], [-2.578392227924596, 1.4921095411686125], [-2.881089051206856, 1.4988938721533487], [-3.1849417424623754, 1.5029247008889282], [-3.4825354842990794, 1.493890544937176], [-3.750689740436765, 1.465049614488882], [-3.9880722647313016, 1.4135843480377999], [-4.205939717416662, 1.3337715093327212], [-4.367340384426731, 1.2364749058410092], [-4.51738731402223, 1.0902756183864817], [-4.645758448067909, 0.888576637674582], [-4.733319013925482, 0.6389363945575649], [-4.763369492422572, 0.3723024846767118], [-4.737969783055661, 0.12611990917316057], [-4.671240362494557, -0.08655067118014204], [-4.572079034051029, -0.26800366831189704], [-4.430700493087873, -0.44065095263395526], [-4.251085729735916, -0.5986728566310193], [-4.035473518882514, -0.7399677738326433], [-3.7871135817758095, -0.8622256213714456], [-3.5101303198712, -0.9639520577165914], [-3.217605089512616, -1.042209949674484], [-2.9237684758541187, -1.0982089910911388], [-2.6285217830723067, -1.1371125447484123], [-2.329685042108611, -1.1626844970134813], [-2.0298820618331384, -1.1772631492180867], [-1.7305451130799856, -1.1829288635218405], [-1.4363602006320286, -1.1814252031753263], [-1.1441208311554993, -1.1741964324726635], [-0.8463659606112404, -1.1619123558635545], [-0.5610194585850078, -1.146177294036526], [-0.29598529204746926, -1.1285994500529926], [-0.022824602679841405, -1.107971247061452], [0.2676023037287788, -1.083703472969232], [0.5521976639323205, -1.060542768105738], [0.8025303710285161, -1.0431674880642523], [1.032314961478044, -1.030840904174684], [1.2843108850012424, -1.0227258302609217], [1.5646907730727948, -1.0226334260062164], [1.8486142405819024, -1.0348787080082629], [2.1271233969639134, -1.0628641714976248], [2.40890773137782, -1.1066491248656067], [2.676604974701839, -1.1607885077820748], [2.895820813571048, -1.21452402864476], [3.105199827963476, -1.2733493445672712], [3.3545262027550438, -1.3423104739351408], [3.630400286520526, -1.3992347424639746], [3.9048398250605825, -1.4249351189066115], [4.1639877556275975, -1.4070832082809437], [4.387680613995181, -1.3420687680744092], [4.561202906128716, -1.239111535328041], [4.673663473617282, -1.1219616423116654], [4.7818119907918675, -0.9444253582613691], [4.861528239766634, -0.716289189511073], [4.899075172664469, -0.44317940031160763], [4.886167092470751, -0.15084434555953735], [4.8275512852162885, 0.1355988508220772], [4.732542352719036, 0.4000650344332048], [4.610977683787232, 0.6329165786531988], [4.4717432369753105, 0.8301157321265491], [4.313985826847224, 0.9989641918018666], [4.142657437401209, 1.1306016363332645], [3.9326227331396755, 1.2430868002190745], [3.6868964164445526, 1.3345908288747816], [3.474717390360791, 1.3893942937832449]]
racing_line = [[ 3.02139987e+00,  1.45869374e+00], #0
       [ 2.79611184e+00,  1.47645259e+00], #1
       [ 2.55766258e+00,  1.48780603e+00], #2
       [ 2.29900224e+00,  1.49458953e+00], #3
       [ 2.02424354e+00,  1.49874595e+00], #4
       [ 1.74275391e+00,  1.50110821e+00], #5
       [ 1.45725946e+00,  1.50199393e+00], #6
       [ 1.16886336e+00,  1.50162237e+00], #7
       [ 8.78304133e-01,  1.50021371e+00], #8
       [ 5.86069246e-01,  1.49794748e+00], #9
       [ 2.92466572e-01,  1.49494849e+00], #10
       [-2.22807462e-03,  1.49134398e+00], #11
       [-3.05033588e-01,  1.48822038e+00], #12
       [-6.07850904e-01,  1.48569301e+00], #13
       [-9.10677172e-01,  1.48382932e+00], #14
       [-1.21350835e+00,  1.48270283e+00], #15
       [-1.51633800e+00,  1.48247677e+00], #16
       [-1.81915338e+00,  1.48333176e+00], #17
       [-2.12192930e+00,  1.48550648e+00], #18
       [-2.42461912e+00,  1.48924952e+00], #19
       [-2.72713106e+00,  1.49487593e+00], #20
       [-3.02929272e+00,  1.50276164e+00], #21
       [-3.31666816e+00,  1.50306270e+00], #22
       [-3.58971910e+00,  1.48796349e+00], #23
       [-3.84740433e+00,  1.45128247e+00], #24
       [-4.08736552e+00,  1.38697438e+00], #25
       [-4.30556573e+00,  1.28907047e+00], #26
       [-4.48263832e+00,  1.13830908e+00], #27
       [-4.61868080e+00,  9.50257845e-01], #28
       [-4.71254361e+00,  7.36444170e-01], #29
       [-4.76149703e+00,  5.06685023e-01], #30
       [-4.76477995e+00,  2.71077025e-01], #31
       [-4.72186912e+00,  3.90669011e-02], #32
       [-4.63340804e+00, -1.80418361e-01], #33
       [-4.49616860e+00, -3.76413035e-01], #34
       [-4.32149836e+00, -5.47801105e-01], #35
       [-4.11656266e+00, -6.95863150e-01], #36
       [-3.88551122e+00, -8.21532712e-01], #37
       [-3.63215805e+00, -9.26308373e-01], #38
       [-3.35909999e+00, -1.01054260e+00], #39
       [-3.07092028e+00, -1.07503883e+00], #40
       [-2.77581412e+00, -1.12150552e+00], #41
       [-2.47917460e+00, -1.15293730e+00], #42
       [-2.18295538e+00, -1.17225174e+00], #43
       [-1.88891336e+00, -1.18187827e+00], #44
       [-1.59804671e+00, -1.18380784e+00], #45
       [-1.31031011e+00, -1.17956771e+00], #46
       [-1.02527294e+00, -1.17035524e+00], #47
       [-7.42518477e-01, -1.15701164e+00], #48
       [-4.61653778e-01, -1.14024579e+00], #49
       [-1.82360881e-01, -1.12061176e+00], #50
       [ 9.56350748e-02, -1.09858535e+00], #51
       [ 3.72592885e-01, -1.07461769e+00], #52
       [ 6.41497759e-01, -1.05354467e+00], #53
       [ 9.09609952e-01, -1.03626712e+00], #54
       [ 1.17663085e+00, -1.02445902e+00], #55
       [ 1.44221791e+00, -1.02018420e+00], #56
       [ 1.70606482e+00, -1.02546064e+00], #57
       [ 1.96778854e+00, -1.04275241e+00], #58
       [ 2.22680099e+00, -1.07544580e+00], #59
       [ 2.48377653e+00, -1.11947762e+00], #60
       [ 2.73879640e+00, -1.17411218e+00], #61
       [ 2.99174125e+00, -1.23921014e+00], #62
       [ 3.24113400e+00, -1.31425136e+00], #63
       [ 3.48919940e+00, -1.37563561e+00], #64
       [ 3.73499993e+00, -1.41671665e+00], #65
       [ 3.97597469e+00, -1.42837730e+00], #66
       [ 4.20765790e+00, -1.40213719e+00], #67
       [ 4.42281524e+00, -1.33034535e+00], #68
       [ 4.61056875e+00, -1.20656648e+00], #69
       [ 4.74879565e+00, -1.02121557e+00], #70
       [ 4.84434714e+00, -7.98979581e-01], #71
       [ 4.89637089e+00, -5.48596060e-01], #72
       [ 4.90323568e+00, -2.80997099e-01], #73
       [ 4.86793001e+00, -1.17814914e-02], #74
       [ 4.79713758e+00,  2.46607366e-01], #75
       [ 4.69598542e+00,  4.86912653e-01], #76
       [ 4.56896570e+00,  7.05073712e-01], #77
       [ 4.41912338e+00,  8.97792409e-01], #78
       [ 4.24898530e+00,  1.06151291e+00], #79
       [ 4.05933211e+00,  1.18474399e+00], #80
       [ 3.86040708e+00,  1.27633820e+00], #81
       [ 3.65667633e+00,  1.34473660e+00], #82
       [ 3.44942397e+00,  1.39560199e+00], #83
       [ 3.23819139e+00,  1.43252829e+00], #84
       [ 3.02139987e+00,  1.45869374e+00]] #85
racing_line_new = [[3.3966135878355668, 1.4048339560864744], [3.2705586838304703, 1.4268700510949406], [3.1451706167544136, 1.4437553453355534], [2.974481553982661, 1.4623921847704768], [2.6719899439851504, 1.4823624867180307], [2.3687759972195184, 1.492759677452452], [2.065674981941035, 1.4981191946910233], [1.7698551761254664, 1.5008807762685423], [1.4829242752885623, 1.5019143072956098], [1.1827320920156181, 1.501640238015787], [0.8999462217968416, 1.5003186329966616], [0.6057667798555759, 1.4981002309005096], [0.30333388910664355, 1.495059493673385], [-0.00010562534685010228, 1.4913699403956748], [-0.30332947749746564, 1.4882379588066283], [-0.6066819029940562, 1.4857027667012066], [-0.9100546126511451, 1.4838331514299499], [-1.2134304776723992, 1.482703119674263], [-1.5167746245391232, 1.4824780027960844], [-1.8201495602510778, 1.483338915169789], [-2.123509329295038, 1.4855260185257835], [-2.426832572126357, 1.4892906879260601], [-2.7297849190293486, 1.4949451894907189], [-3.0334500011881746, 1.5027659952471795], [-3.338164340588126, 1.5018740011260903], [-3.6214476122848094, 1.4834469944535176], [-3.8539070616212063, 1.4495397788158864], [-4.08736552, 1.38697438], [-4.30556573, 1.28907047], [-4.481479920826172, 1.1392953527462293], [-4.601595077325136, 0.9738754036469437], [-4.705271051897833, 0.7530106074897277], [-4.76149703, 0.506685023], [-4.7638283659561464, 0.26593200375674503], [-4.72186912, 0.039066901099999995], [-4.63340804, -0.180418361], [-4.4961686, -0.376413035], [-4.326211171789533, -0.5431768500789482], [-4.136555689847952, -0.6814185759944277], [-3.9097956013697694, -0.8083243651046945], [-3.653366250604141, -0.9175375996289012], [-3.365501764346146, -1.0085677507189494], [-3.07092028, -1.07503883], [-2.7758980548235677, -1.1214923038291584], [-2.4791746, -1.1529373], [-2.181285174365847, -1.1723064202278237], [-1.8812307725447066, -1.1819292352456756], [-1.5815029744641789, -1.1835640490142252], [-1.2910815963241273, -1.178946239805837], [-0.9960387456106391, -1.168975635264092], [-0.6962547072825865, -1.1542499849173984], [-0.426825136847027, -1.137797369031898], [-0.16735184915399923, -1.1194225517318737], [0.11926141264756135, -1.0965407496611739], [0.4184293973461625, -1.0710256623545622], [0.6882644568423436, -1.050530954169829], [0.9160942828141603, -1.035980372306242], [1.148535640141928, -1.025701436043126], [1.42645693049641, -1.0204378846125017], [1.70606482, -1.02546064], [1.9766576494400883, -1.0438718977075503], [2.260888175138789, -1.081286514646763], [2.5423335610133244, -1.1320226723691325], [2.801333348217993, -1.190206707141458], [2.990308278924103, -1.2388413501480622], [3.2200029174018656, -1.3078931069309563], [3.4891994, -1.37563561], [3.753567404133212, -1.4176151209321899], [4.0149382426388796, -1.4239643435875133], [4.246250497949515, -1.3892599457601524], [4.435461198470236, -1.322008342348251], [4.61056875, -1.20656648], [4.74879565, -1.02121557], [4.836752136696826, -0.8166442251676547], [4.890862153090682, -0.5751088919972673], [4.902931536414644, -0.29285303449637196], [4.867078854657986, -0.008674816628517297], [4.789486288054825, 0.2647843965923884], [4.682074048889052, 0.5108059465272291], [4.558830873551872, 0.7181085512056679], [4.41912338, 0.897792409], [4.2489853, 1.06151291], [4.05933211, 1.18474399], [3.823014394141654, 1.2888920235362777], [3.5564160556256272, 1.3693432098236926], [3.3966135878355668, 1.4048339560864744]]

import numpy as np
from typing import List, Tuple
Point = Tuple[float, float]

def project_point_to_segment(p: np.ndarray, a: np.ndarray, b: np.ndarray) -> np.ndarray:
    v = b - a
    if np.allclose(v, 0):
        return a.copy()
    t = np.dot(p - a, v) / np.dot(v, v)
    t_clamped = max(0.0, min(1.0, t))
    return a + t_clamped * v

def project_point_to_polyline(p: Point, polyline: List[Point]) -> Point:
    p_arr = np.array(p, dtype=float)
    best = None
    best_d2 = float("inf")
    for i in range(len(polyline) - 1):
        a = np.array(polyline[i], dtype=float)
        b = np.array(polyline[i+1], dtype=float)
        proj = project_point_to_segment(p_arr, a, b)
        d2 = np.sum((proj - p_arr) ** 2)
        if d2 < best_d2:
            best_d2 = d2
            best = proj
    if best is None and polyline:
        best = np.array(polyline[0], dtype=float)
    return (float(best[0]), float(best[1]))

def align_racing_line_to_waypoints(L1: List[Point], L2: List[Point]) -> List[Point]:
    """Projiziere jeden Strecken-Waypoint aus L1 auf die Racing Line L2."""
    aligned = [project_point_to_polyline(p, L2) for p in L1]
    return aligned

new_racing_line = align_racing_line_to_waypoints(waypoints_old, racing_line)
print([[x[0],x[1]] for x in new_racing_line])
print(len(new_racing_line))